{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Predict || Heart Disease Predictiion</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body>
    <nav>
        <div class="noncontainer">
            <h3>Heart Disease Prediction</h3>
            <ul>
                <li><a href="{% url 'index' %}">Home</a> </li>
                <li><a href="{% url 'predict' %}">Predict</a> </li>
            </ul>
        </div>
    </nav>
    <div class="formelement">
       
        <div class="container">
            <div class="container-form">
                <header class="header">
                    <h1 id="title" class="text-center">Prediction Input Form</h1>
                    <p id="description" class="text-center fw-normal">
                        Fill the form to predict the chances of Heart Disease
                    </p>
                </header>
                <div id="predictiondisplay"></div>
                <div class="form-wrap">	
                    <form id="predictionForm" >
                        {% csrf_token %}
                        <div class=" row pb-4">
                            <div class="col-md-6 d-flex flex-column justify-content-center">
                                <div class="form-group text-start">
                                    <label id="age-label" for="age" class="text pb-2">Age</label>
                                    <input type="number" name="age" id="age" placeholder="Enter Your Age" class="form-control" min="1" max="150" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group text-start">
                                    <label id="gender-label" for="gender" class="pb-2 text">Gender</label>
                                    <select class="form-select" aria-label="Default select example" name="gender" required id="gender">
                                        <option value="" disabled selected hidden>--Select--</option>
                                        <option value="Male">Male</option>
                                        <option value="Female">Female</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class=" row pb-4 ">
                            <div class="col-md-6">
                                <div class="form-group text-start">
                                    <label id="chest-pain-label" for="name" class="text pb-2">Chest Pain Type</label>
                                    <select class="form-select" aria-label="Default select example" name="chest-pain-type" id="chest-pain-type" required >
                                        <option value="" disabled selected hidden>--Select--</option>
                                        <option value="Typical Angina">Typical Angina</option>
                                        <option value="Atypical Angina">Atypical Angina</option>
                                        <option value="Non-Anginal Pain">Non-Anginal Pain</option>
                                        <option value="Asymptomatic">Asymptomatic</option>
                                        </select>
                                </div>
                            </div>
                            <div class="col-md-6 ">
                                <div class="form-group text-start">
                                    <label id="bp-label" for="bp" class="text pb-2">Resting Blood Pressure (mm/Hg)</label>
                                    <input type="number" name="bp" id="bp" placeholder="Enter Blood Pressure Value" class="form-control" min="90" max="200" required>
                                </div>
                            </div>
                        </div>

                        <div class="row pb-4">
                            <div class="col-md-6">
                            
                                    <div class="form-group text-start">
                                        <label id="cholestoral-label" for="cholestoral" class="text pb-2">Cholestoral (mm/dl)</label>
                                        <input type="number" name="cholestoral" id="cholestoral" placeholder="Enter Cholestoral Value" class="form-control" min="120" max="570" required>
                                    
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group text-start">
                                    <label id="blood-sugar-label" for="blood-sugar" class="text pb-2">Fasting Blood Sugar (mg/dl)</label>
                                    <input type="number" name="blood-sugar" id="blood-sugar" placeholder="Enter Blood Sugar Value" class="form-control" min="0" max="300" required>
                                </div>
                            </div>
                        </div>

                        <div class=" row pb-4">
                            <div class="col-md-6">
                                <div class="form-group text-start">
                                    <label id="electrocardiographic-label" for="name" class="text pb-2">Resting Electrocardiographic Result</label>
                                    <select class="form-select" aria-label="Default select example" name="electrocardiographic" id="electrocardiographic" required>
                                        <option value="" disabled selected hidden>--Select--</option>
                                        <option value="Normal">Normal</option>
                                        <option value="Having ST-T wave abnormality (T wave inversions and/or ST elevation or depression of > 0.05 mV)">Having ST-T wave abnormality (T wave inversions and/or ST elevation or depression of > 0.05 mV)</option>
                                        <option value="Showing probable or definite left ventricular hypertrophy by Estes' criteria">Showing probable or definite left ventricular hypertrophy by Estes' criteria</option>
                                        </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group text-start">
                                    <label id="heart-rate-label" for="heart-rate" class="text pb-2">Maximum Heart Rate Achieved</label>
                                    <input type="number" name="heart-rate" id="heart-rate" placeholder="Enter Heart Rate Value" class="form-control" min="70" max="210" required>
                                </div>
                            </div>
                        </div>

                        <div class=" row pb-4">
                            <div class="col-md-6">
                                <div class="form-group text-start">
                                    <label id="exercise-induced-angina-label" for="exercise-induced-angina" class="pb-2 text">Exercise Induced Angina</label>
                                    <select class="form-select" aria-label="Default select example" name="exercise-induced-angina" id="exercise-induced-angina" required>
                                        <option value="" disabled selected hidden>--Select--</option>
                                        <option value="Yes">Yes</option>
                                        <option value="No">No</option>
                                        </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group text-start">
                                    <label id="oldpeak-label" for="oldpeak" class="text pb-2">Oldpeak</label>
                                    <input type="number" name="oldpeak" id="oldpeak" placeholder="Enter Oldpeak Value" class="form-control" min="0.1" max="10.0" step="0.1" required>
                                </div>
                            </div>
                        </div>

                        <div class=" row pb-4">
                            <div class="col-md-6">
                                <div class="form-group text-start">
                                    <label id="slope-label" for="slope" class="pb-2 text">Slope</label>
                                    <select class="form-select" aria-label="Default select example" name="slope" id="slope" required>
                                        <option value="" disabled selected hidden>--Select--</option>
                                        <option value="Up-Sloping">Up-Sloping</option>
                                        <option value="Flat">Flat</option>
                                        <option value="Down-Sloping">Down-Sloping</option>
                                        </select>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="form-group text-end form-buttons">
                                    <button class="predict-btn" type="submit" id="predictButton">Predict</button>
                                    <button class="clear-btn" type="button" onclick="clearForm()" >Clear</button>
                                </div>
                            </div>

                        </div>

                    </form>
                </div>
            </div>
            
            	
        </div>              
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        async function makePrediction(e) {
            e.preventDefault();
            const formData = new FormData();
    
            formData.append('age', document.getElementById('age').value);
            formData.append('gender', document.getElementById('gender').value);
            formData.append('chest-pain-type', document.getElementById('chest-pain-type').value);
            formData.append('bp', document.getElementById('bp').value);
            formData.append('cholestoral', document.getElementById('cholestoral').value);
            formData.append('blood-sugar',document.getElementById('blood-sugar').value);
            formData.append('exercise-induced-angina', document.getElementById('exercise-induced-angina').value);
            formData.append('heart-rate',document.getElementById('heart-rate').value)
            formData.append('oldpeak', document.getElementById('oldpeak').value);
            formData.append('slope', document.getElementById('slope').value);
            formData.append('electrocardiographic', document.getElementById('electrocardiographic').value);
            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
            formData.append('csrfmiddlewaretoken', csrfToken);

            try {
            console.log(formData);
                const response = await fetch('/prediction/', {
                    method: 'POST',
                    body: formData,
                });

                if (response.ok) {
                    const result = await response.json();
                    if (result.prediction === "No") {
                        document.getElementById('predictiondisplay').innerHTML = '<div class="alert alert-success bg-success text-white" role="alert"> Prediction: Patient Has No Heart Disease </div>';
                    } 
                    else if (result.prediction === "Yes"){
                        document.getElementById('predictiondisplay').innerHTML = '<div class="alert alert-danger bg-danger text-white" role="alert"> Prediction: Patient Has Heart Disease </div>';
                    }
                    console.log(result.prediction);  
                } else {
                    console.error('Failed to make the prediction:', response.status);
                }
            } 
            catch (error) {
                console.error('Error:', error);
            }
        }

        document.getElementById('predictButton').addEventListener('click', makePrediction);

        function clearForm() {
            var form = document.getElementById('predictionForm');
            form.reset();

            // Clear alert messages
            var predictionDisplay = document.getElementById('predictiondisplay');
            if (predictionDisplay) {
                predictionDisplay.innerHTML = ''; // Clear the content
            }
        }
    </script>
</body>
</html>




